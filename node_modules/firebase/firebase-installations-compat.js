<<<<<<< HEAD
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).firebase,t.firebase.INTERNAL.modularAPIs)}(this,function(It,St){"use strict";try{!(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r,e=t(It);class o extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,a.prototype.create)}}class a{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){var r,n=e[0]||{},a=`${this.service}/${t}`,i=this.errors[t],i=i?(r=n,i.replace(s,(t,e)=>{var n=r[e];return null!=n?String(n):`<${e}?>`})):"Error",i=`${this.serviceName}: ${i} (${a}).`;return new o(a,i,n)}}const s=/\{\$([^}]+)}/g;class n{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const c=(e,t)=>t.some(t=>e instanceof t);let u,i;const f=new WeakMap,p=new WeakMap,d=new WeakMap,l=new WeakMap,g=new WeakMap;let h={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return p.get(t);if("objectStoreNames"===e)return t.objectStoreNames||d.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return m(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t}};function v(r){return r!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(i=i||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(r)?function(...t){return r.apply(y(this),t),m(f.get(this))}:function(...t){return m(r.apply(y(this),t))}:function(t,...e){var n=r.call(y(this),t,...e);return d.set(n,t.sort?t.sort():[t]),m(n)}}function w(t){return"function"==typeof t?v(t):(t instanceof IDBTransaction&&(i=t,p.has(i)||(e=new Promise((t,e)=>{const n=()=>{i.removeEventListener("complete",r),i.removeEventListener("error",a),i.removeEventListener("abort",a)},r=()=>{t(),n()},a=()=>{e(i.error||new DOMException("AbortError","AbortError")),n()};i.addEventListener("complete",r),i.addEventListener("error",a),i.addEventListener("abort",a)}),p.set(i,e))),c(t,u=u||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(t,h):t);var i,e}function m(t){if(t instanceof IDBRequest)return function(i){const t=new Promise((t,e)=>{const n=()=>{i.removeEventListener("success",r),i.removeEventListener("error",a)},r=()=>{t(m(i.result)),n()},a=()=>{e(i.error),n()};i.addEventListener("success",r),i.addEventListener("error",a)});return t.then(t=>{t instanceof IDBCursor&&f.set(t,i)}).catch(()=>{}),g.set(t,i),t}(t);if(l.has(t))return l.get(t);var e=w(t);return e!==t&&(l.set(t,e),g.set(e,t)),e}const y=t=>g.get(t);const b=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],S=new Map;function C(t,e){if(t instanceof IDBDatabase&&!(e in t)&&"string"==typeof e){if(S.get(e))return S.get(e);const a=e.replace(/FromIndex$/,""),i=e!==a,o=I.includes(a);if(a in(i?IDBIndex:IDBObjectStore).prototype&&(o||b.includes(a))){var n=async function(t,...e){var n=this.transaction(t,o?"readwrite":"readonly");let r=n.store;return i&&(r=r.index(e.shift())),(await Promise.all([r[a](...e),o&&n.done]))[0]};return S.set(e,n),n}}}h={...r=h,get:(t,e,n)=>C(t,e)||r.get(t,e,n),has:(t,e)=>!!C(t,e)||r.has(t,e)};var T="@firebase/installations",k="0.6.9";const E=1e4,j=`w:${k}`,D="FIS_v2",P="https://firebaseinstallations.googleapis.com/v1",$=36e5;var B;const L=new a("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function q(t){return t instanceof o&&t.code.includes("request-failed")}function N({projectId:t}){return`${P}/projects/${t}/installations`}function O(t){return{token:t.token,requestStatus:2,expiresIn:(t=t.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()}}async function A(t,e){var n=(await e.json()).error;return L.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function M({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}function x(t,{refreshToken:e}){const n=M(t);return n.append("Authorization",(e=e,`${D} ${e}`)),n}async function V(t){var e=await t();return 500<=e.status&&e.status<600?t():e}function _(e){return new Promise(t=>{setTimeout(t,e)})}const F=/^[cdef][\w-]{21}$/,K="";function H(){try{const e=new Uint8Array(17),n=self.crypto||self.msCrypto;n.getRandomValues(e),e[0]=112+e[0]%16;var t=function(t){const e=function(t){const e=btoa(String.fromCharCode(...t));return e.replace(/\+/g,"-").replace(/\//g,"_")}(t);return e.substr(0,22)}(e);return F.test(t)?t:K}catch(t){return K}}function R(t){return`${t.appName}!${t.appId}`}const W=new Map;function z(t,e){var n=R(t);U(n,e),function(t,e){const n=G();n&&n.postMessage({key:t,fid:e});Y()}(n,e)}function U(t,e){var n=W.get(t);if(n)for(const r of n)r(e)}let J=null;function G(){return!J&&"BroadcastChannel"in self&&(J=new BroadcastChannel("[Firebase] FID Change"),J.onmessage=t=>{U(t.data.key,t.data.fid)}),J}function Y(){0===W.size&&J&&(J.close(),J=null)}const Z="firebase-installations-database",Q=1,X="firebase-installations-store";let tt=null;function et(){return tt=tt||function(t,e,{blocked:n,upgrade:r,blocking:a,terminated:i}){const o=indexedDB.open(t,e),s=m(o);return r&&o.addEventListener("upgradeneeded",t=>{r(m(o.result),t.oldVersion,t.newVersion,m(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),s.then(t=>{i&&t.addEventListener("close",()=>i()),a&&t.addEventListener("versionchange",t=>a(t.oldVersion,t.newVersion,t))}).catch(()=>{}),s}(Z,Q,{upgrade:(t,e)=>{0===e&&t.createObjectStore(X)}}),tt}async function nt(t,e){var n=R(t);const r=await et(),a=r.transaction(X,"readwrite"),i=a.objectStore(X);var o=await i.get(n);return await i.put(e,n),await a.done,o&&o.fid===e.fid||z(t,e.fid),e}async function rt(t){var e=R(t);const n=await et(),r=n.transaction(X,"readwrite");await r.objectStore(X).delete(e),await r.done}async function at(t,e){var n=R(t);const r=await et(),a=r.transaction(X,"readwrite"),i=a.objectStore(X);var o=await i.get(n),s=e(o);return void 0===s?await i.delete(n):await i.put(s,n),await a.done,!s||o&&o.fid===s.fid||z(t,s.fid),s}async function it(n){let r;var t=await at(n.appConfig,t=>{var e=st(t||{fid:H(),registrationStatus:0}),e=function(t,e){{if(0!==e.registrationStatus)return 1===e.registrationStatus?{installationEntry:e,registrationPromise:async function(t){let e=await ot(t.appConfig);for(;1===e.registrationStatus;)await _(100),e=await ot(t.appConfig);if(0!==e.registrationStatus)return e;{var{installationEntry:n,registrationPromise:r}=await it(t);return r||n}}(t)}:{installationEntry:e};if(!navigator.onLine){var n=Promise.reject(L.create("app-offline"));return{installationEntry:e,registrationPromise:n}}var r={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},n=async function(e,n){try{var t=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const r=N(t),a=M(t),i=e.getImmediate({optional:!0});!i||(o=await i.getHeartbeatsHeader())&&a.append("x-firebase-client",o);var o={fid:n,authVersion:D,appId:t.appId,sdkVersion:j};const s={method:"POST",headers:a,body:JSON.stringify(o)},c=await V(()=>fetch(r,s));if(c.ok){o=await c.json();return{fid:o.fid||n,registrationStatus:2,refreshToken:o.refreshToken,authToken:O(o.authToken)}}throw await A("Create Installation",c)}(e,n);return nt(e.appConfig,t)}catch(t){throw q(t)&&409===t.customData.serverCode?await rt(e.appConfig):await nt(e.appConfig,{fid:n.fid,registrationStatus:0}),t}}(t,r);return{installationEntry:r,registrationPromise:n}}}(n,e);return r=e.registrationPromise,e.installationEntry});return t.fid===K?{installationEntry:await r}:{installationEntry:t,registrationPromise:r}}function ot(t){return at(t,t=>{if(!t)throw L.create("installation-not-found");return st(t)})}function st(t){return 1===(e=t).registrationStatus&&e.registrationTime+E<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function ct({appConfig:t,heartbeatServiceProvider:e},n){const r=([a,i]=[t,n["fid"]],`${N(a)}/${i}/authTokens:generate`);var a,i;const o=x(t,n),s=e.getImmediate({optional:!0});!s||(c=await s.getHeartbeatsHeader())&&o.append("x-firebase-client",c);var c={installation:{sdkVersion:j,appId:t.appId}};const u={method:"POST",headers:o,body:JSON.stringify(c)},f=await V(()=>fetch(r,u));if(f.ok)return O(await f.json());throw await A("Generate Auth Token",f)}async function ut(r,a=!1){let i;var t=await at(r.appConfig,t=>{if(!pt(t))throw L.create("not-registered");var e,n=t.authToken;if(a||2!==(e=n).requestStatus||function(t){var e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+$}(e)){if(1===n.requestStatus)return i=async function(t,e){let n=await ft(t.appConfig);for(;1===n.authToken.requestStatus;)await _(100),n=await ft(t.appConfig);var r=n.authToken;return 0===r.requestStatus?ut(t,e):r}(r,a),t;if(!navigator.onLine)throw L.create("app-offline");n=(e=t,n={requestStatus:1,requestTime:Date.now()},Object.assign(Object.assign({},e),{authToken:n}));return i=async function(e,n){try{var r=await ct(e,n),t=Object.assign(Object.assign({},n),{authToken:r});return await nt(e.appConfig,t),r}catch(t){throw!q(t)||401!==t.customData.serverCode&&404!==t.customData.serverCode?(r=Object.assign(Object.assign({},n),{authToken:{requestStatus:0}}),await nt(e.appConfig,r)):await rt(e.appConfig),t}}(r,n),n}return t});return i?await i:t.authToken}function ft(t){return at(t,t=>{if(!pt(t))throw L.create("not-registered");var e,n=t.authToken;return 1===(e=n).requestStatus&&e.requestTime+E<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t})}function pt(t){return void 0!==t&&2===t.registrationStatus}async function dt(t){var e=t;const{installationEntry:n,registrationPromise:r}=await it(e);return(r||ut(e)).catch(console.error),n.fid}async function lt(t,e=!1){var n,r=t;return await((n=(await it(r)).registrationPromise)&&await n),(await ut(r,e)).token}async function gt(t,e){const n=([r,a]=[t,e["fid"]],`${N(r)}/${a}`);var r,a;const i={method:"DELETE",headers:x(t,e)};var o=await V(()=>fetch(n,i));if(!o.ok)throw await A("Delete Installation",o)}function ht(t,e){const n=t["appConfig"];return function(t,e){G();var n=R(t);let r=W.get(n);r||(r=new Set,W.set(n,r)),r.add(e)}(n,e),()=>{!function(t,e){var n=R(t);const r=W.get(n);r&&(r.delete(e),0===r.size&&W.delete(n),Y())}(n,e)}}function vt(t){return L.create("missing-app-config-values",{valueName:t})}const wt="installations",mt=t=>{var e=t.getProvider("app").getImmediate();return{app:e,appConfig:function(t){if(!t||!t.options)throw vt("App Configuration");if(!t.name)throw vt("App Name");for(const e of["projectId","apiKey","appId"])if(!t.options[e])throw vt(e);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e),heartbeatServiceProvider:St._getProvider(e,"heartbeat"),_delete:()=>Promise.resolve()}},yt=t=>{var e=t.getProvider("app").getImmediate();const n=St._getProvider(e,wt).getImmediate();return{getId:()=>dt(n),getToken:t=>lt(n,t)}};St._registerComponent(new n(wt,mt,"PUBLIC")),St._registerComponent(new n("installations-internal",yt,"PRIVATE")),St.registerVersion(T,k),St.registerVersion(T,k,"esm2017");class bt{constructor(t,e){this.app=t,this._delegate=e}getId(){return dt(this._delegate)}getToken(t){return lt(this._delegate,t)}delete(){return async function(t){var e=t["appConfig"],n=await at(e,t=>{if(!t||0!==t.registrationStatus)return t});if(n){if(1===n.registrationStatus)throw L.create("delete-pending-registration");if(2===n.registrationStatus){if(!navigator.onLine)throw L.create("app-offline");await gt(e,n),await rt(e)}}}(this._delegate)}onIdChange(t){return ht(this._delegate,t)}}(B=e.default).INTERNAL.registerComponent(new n("installations-compat",t=>{var e=t.getProvider("app-compat").getImmediate(),n=t.getProvider("installations").getImmediate();return new bt(e,n)},"PUBLIC")),B.registerVersion("@firebase/installations-compat","0.2.9")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-installations-compat.js - be sure to load firebase-app.js first.")}});
=======
((e,t)=>{"object"==typeof exports&&"undefined"!=typeof module?t(require("@firebase/app-compat"),require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app-compat","@firebase/app"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).firebase,e.firebase.INTERNAL.modularAPIs)})(this,function(be,Se){try{!(function(){function x(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}let V=x(be);class o extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,o.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,a.prototype.create)}}class a{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var a,r=t[0]||{},n=this.service+"/"+e,i=this.errors[e],i=i?(a=r,i.replace($,(e,t)=>{var r=a[t];return null!=r?String(r):`<${t}?>`})):"Error",i=this.serviceName+`: ${i} (${n}).`;return new o(n,i,r)}}let $=/\{\$([^}]+)}/g;class e{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let _=(t,e)=>e.some(e=>t instanceof e),r,t;let n=new WeakMap,s=new WeakMap,i=new WeakMap,u=new WeakMap,c=new WeakMap;let l={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return s.get(e);if("objectStoreNames"===t)return e.objectStoreNames||i.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return p(e[t])},set(e,t,r){return e[t]=r,!0},has(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function O(a){return a!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(t=t||[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey]).includes(a)?function(...e){return a.apply(d(this),e),p(n.get(this))}:function(...e){return p(a.apply(d(this),e))}:function(e,...t){var r=a.call(d(this),e,...t);return i.set(r,e.sort?e.sort():[e]),p(r)}}function F(e){var i,t;return"function"==typeof e?O(e):(e instanceof IDBTransaction&&(i=e,s.has(i)||(t=new Promise((e,t)=>{let r=()=>{i.removeEventListener("complete",a),i.removeEventListener("error",n),i.removeEventListener("abort",n)},a=()=>{e(),r()},n=()=>{t(i.error||new DOMException("AbortError","AbortError")),r()};i.addEventListener("complete",a),i.addEventListener("error",n),i.addEventListener("abort",n)}),s.set(i,t))),_(e,r=r||[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])?new Proxy(e,l):e)}function p(e){var i,t;return e instanceof IDBRequest?(i=e,(t=new Promise((e,t)=>{let r=()=>{i.removeEventListener("success",a),i.removeEventListener("error",n)},a=()=>{e(p(i.result)),r()},n=()=>{t(i.error),r()};i.addEventListener("success",a),i.addEventListener("error",n)})).then(e=>{e instanceof IDBCursor&&n.set(e,i)}).catch(()=>{}),c.set(t,i),t):u.has(e)?u.get(e):((t=F(e))!==e&&(u.set(e,t),c.set(t,e)),t)}let d=e=>c.get(e);let K=["get","getKey","getAll","getAllKeys","count"],H=["put","add","delete","clear"],f=new Map;function g(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t){if(f.get(t))return f.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,o=H.includes(n);var r;return n in(i?IDBIndex:IDBObjectStore).prototype&&(o||K.includes(n))?(r=async function(e,...t){var r=this.transaction(e,o?"readwrite":"readonly");let a=r.store;return i&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),o&&r.done]))[0]},f.set(t,r),r):void 0}}l={...h=l,get:(e,t,r)=>g(e,t)||h.get(e,t,r),has:(e,t)=>!!g(e,t)||h.has(e,t)};var h,v="@firebase/installations",w="0.6.19";let m=1e4,y="w:"+w,R="FIS_v2",W="https://firebaseinstallations.googleapis.com/v1",z=36e5;var U;let I=new a("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function J(e){return e instanceof o&&e.code.includes("request-failed")}function b({projectId:e}){return W+`/projects/${e}/installations`}function G(e){return{token:e.token,requestStatus:2,expiresIn:Number(e.expiresIn.replace("s","000")),creationTime:Date.now()}}async function S(e,t){var r=(await t.json()).error;return I.create("request-failed",{requestName:e,serverCode:r.code,serverMessage:r.message,serverStatus:r.status})}function Y({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}function Z(e,{refreshToken:t}){var r=Y(e);return r.append("Authorization",(e=t,R+" "+e)),r}async function C(e){var t=await e();return 500<=t.status&&t.status<600?e():t}function Q(t){return new Promise(e=>{setTimeout(e,t)})}let X=/^[cdef][\w-]{21}$/,T="";function ee(){try{var e=new Uint8Array(17),t=((self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16,(e=>btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_"))(e).substr(0,22));return X.test(t)?t:T}catch{return T}}function k(e){return e.appName+"!"+e.appId}let E=new Map;function te(e,t){var r=k(e),e=(re(r,t),r),r=ae();r&&r.postMessage({key:e,fid:t}),ne()}function re(e,t){var r=E.get(e);if(r)for(var a of r)a(t)}let D=null;function ae(){return!D&&"BroadcastChannel"in self&&((D=new BroadcastChannel("[Firebase] FID Change")).onmessage=e=>{re(e.data.key,e.data.fid)}),D}function ne(){0===E.size&&D&&(D.close(),D=null)}let ie="firebase-installations-database",oe=1,P="firebase-installations-store",se=null;function j(){return se=se||((e,t,{blocked:r,upgrade:a,blocking:n,terminated:i})=>{let o=indexedDB.open(e,t);var s=p(o);return a&&o.addEventListener("upgradeneeded",e=>{a(p(o.result),e.oldVersion,e.newVersion,p(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s})(ie,oe,{upgrade:(e,t)=>{0===t&&e.createObjectStore(P)}})}async function B(e,t){var r=k(e),a=(await j()).transaction(P,"readwrite"),n=a.objectStore(P),i=await n.get(r);return await n.put(t,r),await a.done,i&&i.fid===t.fid||te(e,t.fid),t}async function L(e){var t=k(e),r=(await j()).transaction(P,"readwrite");await r.objectStore(P).delete(t),await r.done}async function q(e,t){var r=k(e),a=(await j()).transaction(P,"readwrite"),n=a.objectStore(P),i=await n.get(r),o=t(i);return void 0===o?await n.delete(r):await n.put(o,r),await a.done,!o||i&&i.fid===o.fid||te(e,o.fid),o}async function N(r){let a;var e=await q(r.appConfig,e=>{var t=ce(e||{fid:ee(),registrationStatus:0}),t=((e,t)=>{var r,a;return 0===t.registrationStatus?navigator.onLine?(r={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},a=(async(t,r)=>{try{var e=await(async({appConfig:e,heartbeatServiceProvider:t},{fid:r})=>{let a=b(e);var n=Y(e),i=((i=t.getImmediate({optional:!0}))&&(i=await i.getHeartbeatsHeader())&&n.append("x-firebase-client",i),{fid:r,authVersion:R,appId:e.appId,sdkVersion:y});let o={method:"POST",headers:n,body:JSON.stringify(i)};if((n=await C(()=>fetch(a,o))).ok)return{fid:(i=await n.json()).fid||r,registrationStatus:2,refreshToken:i.refreshToken,authToken:G(i.authToken)};throw await S("Create Installation",n)})(t,r);return B(t.appConfig,e)}catch(e){throw J(e)&&409===e.customData.serverCode?await L(t.appConfig):await B(t.appConfig,{fid:r.fid,registrationStatus:0}),e}})(e,r),{installationEntry:r,registrationPromise:a}):(r=Promise.reject(I.create("app-offline")),{installationEntry:t,registrationPromise:r}):1===t.registrationStatus?{installationEntry:t,registrationPromise:(async e=>{let t=await ue(e.appConfig);for(;1===t.registrationStatus;)await Q(100),t=await ue(e.appConfig);var r,a;return 0!==t.registrationStatus?t:({installationEntry:r,registrationPromise:a}=await N(e),a||r)})(e)}:{installationEntry:t}})(r,t);return a=t.registrationPromise,t.installationEntry});return e.fid===T?{installationEntry:await a}:{installationEntry:e,registrationPromise:a}}function ue(e){return q(e,e=>{if(e)return ce(e);throw I.create("installation-not-found")})}function ce(e){var t;return 1===(t=e).registrationStatus&&t.registrationTime+m<Date.now()?{fid:e.fid,registrationStatus:0}:e}async function le({appConfig:e,heartbeatServiceProvider:t},r){[n,i]=[e,r.fid];let a=b(n)+`/${i}/authTokens:generate`;var n,i,o=Z(e,r),s=t.getImmediate({optional:!0}),s=(s&&(s=await s.getHeartbeatsHeader())&&o.append("x-firebase-client",s),{installation:{sdkVersion:y,appId:e.appId}});let u={method:"POST",headers:o,body:JSON.stringify(s)};o=await C(()=>fetch(a,u));if(o.ok)return G(await o.json());throw await S("Generate Auth Token",o)}async function A(a,n=!1){let i;var e=await q(a.appConfig,e=>{if(!de(e))throw I.create("not-registered");var t,r=e.authToken;if(n||2!==(t=r).requestStatus||(e=>{var t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+z})(t)){if(1===r.requestStatus)return i=(async(e,t)=>{let r=await pe(e.appConfig);for(;1===r.authToken.requestStatus;)await Q(100),r=await pe(e.appConfig);var a=r.authToken;return 0===a.requestStatus?A(e,t):a})(a,n),e;if(navigator.onLine)return t=e,r={requestStatus:1,requestTime:Date.now()},r={...t,authToken:r},i=(async(t,r)=>{try{var e=await le(t,r),a={...r,authToken:e};return await B(t.appConfig,a),e}catch(e){var n;throw!J(e)||401!==e.customData.serverCode&&404!==e.customData.serverCode?(n={...r,authToken:{requestStatus:0}},await B(t.appConfig,n)):await L(t.appConfig),e}})(a,r),r;throw I.create("app-offline")}return e});return i?await i:e.authToken}function pe(e){return q(e,e=>{var t,r;if(de(e))return t=e.authToken,1===(r=t).requestStatus&&r.requestTime+m<Date.now()?{...e,authToken:{requestStatus:0}}:e;throw I.create("not-registered")})}function de(e){return void 0!==e&&2===e.registrationStatus}async function fe(e){var t=e,{installationEntry:r,registrationPromise:a}=await N(t);return(a||A(t)).catch(console.error),r.fid}async function ge(e,t=!1){var r=e,a=(await(!(a=(await N(r)).registrationPromise)||!await a),await A(r,t));return a.token}async function he(e,t){[a,n]=[e,t.fid];let r=b(a)+"/"+n;var a,n;let i={method:"DELETE",headers:Z(e,t)};var o=await C(()=>fetch(r,i));if(!o.ok)throw await S("Delete Installation",o)}function ve(t,n){let i=t.appConfig;{t=i;var r=n,a=(ae(),k(t));let e=E.get(a);e||(e=new Set,E.set(a,e)),e.add(r)}return()=>{var e,t,r,a;e=i,t=n,r=k(e),(a=E.get(r))&&(a.delete(t),0===a.size&&E.delete(r),ne())}}function M(e){return I.create("missing-app-config-values",{valueName:e})}let we="installations",me=e=>{var t=e.getProvider("app").getImmediate();return{app:t,appConfig:(e=>{if(!e||!e.options)throw M("App Configuration");if(!e.name)throw M("App Name");var t;for(t of["projectId","apiKey","appId"])if(!e.options[t])throw M(t);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}})(t),heartbeatServiceProvider:Se._getProvider(t,"heartbeat"),_delete:()=>Promise.resolve()}},ye=e=>{var t=e.getProvider("app").getImmediate();let r=Se._getProvider(t,we).getImmediate();return{getId:()=>fe(r),getToken:e=>ge(r,e)}};Se._registerComponent(new e(we,me,"PUBLIC")),Se._registerComponent(new e("installations-internal",ye,"PRIVATE")),Se.registerVersion(v,w),Se.registerVersion(v,w,"esm2020");class Ie{constructor(e,t){this.app=e,this._delegate=t}getId(){return fe(this._delegate)}getToken(e){return ge(this._delegate,e)}delete(){return(async e=>{var t=e.appConfig,r=await q(t,e=>{if(!e||0!==e.registrationStatus)return e});if(r){if(1===r.registrationStatus)throw I.create("delete-pending-registration");if(2===r.registrationStatus){if(!navigator.onLine)throw I.create("app-offline");await he(t,r),await L(t)}}})(this._delegate)}onIdChange(e){return ve(this._delegate,e)}}(U=V.default).INTERNAL.registerComponent(new e("installations-compat",e=>{var t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("installations").getImmediate();return new Ie(t,r)},"PUBLIC")),U.registerVersion("@firebase/installations-compat","0.2.19")}).apply(this,arguments)}catch(e){throw console.error(e),new Error("Cannot instantiate firebase-installations-compat.js - be sure to load firebase-app.js first.")}});
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
//# sourceMappingURL=firebase-installations-compat.js.map
