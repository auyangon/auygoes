// Export is needed because TypeScript complains about an error otherwise:
// Error: …/tailwind-merge/src/config-utils.ts(8,17): semantic error TS4058: Return type of exported function has or is using name 'LruCache' from external module "…/tailwind-merge/src/lru-cache" but cannot be named.
<<<<<<< HEAD
export interface LruCache<Key, Value> {
=======
export interface LruCache<Key extends string, Value> {
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
    get(key: Key): Value | undefined
    set(key: Key, value: Value): void
}

<<<<<<< HEAD
// LRU cache inspired from hashlru (https://github.com/dominictarr/hashlru/blob/v1.0.4/index.js) but object replaced with Map to improve performance
export const createLruCache = <Key, Value>(maxCacheSize: number): LruCache<Key, Value> => {
=======
// LRU cache implementation using plain objects for simplicity
export const createLruCache = <Key extends string, Value>(
    maxCacheSize: number,
): LruCache<Key, Value> => {
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
    if (maxCacheSize < 1) {
        return {
            get: () => undefined,
            set: () => {},
        }
    }

    let cacheSize = 0
<<<<<<< HEAD
    let cache = new Map<Key, Value>()
    let previousCache = new Map<Key, Value>()

    const update = (key: Key, value: Value) => {
        cache.set(key, value)
=======
    let cache: Record<Key, Value> = Object.create(null)
    let previousCache: Record<Key, Value> = Object.create(null)

    const update = (key: Key, value: Value) => {
        cache[key] = value
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
        cacheSize++

        if (cacheSize > maxCacheSize) {
            cacheSize = 0
            previousCache = cache
<<<<<<< HEAD
            cache = new Map()
=======
            cache = Object.create(null)
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
        }
    }

    return {
        get(key) {
<<<<<<< HEAD
            let value = cache.get(key)
=======
            let value = cache[key]
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec

            if (value !== undefined) {
                return value
            }
<<<<<<< HEAD
            if ((value = previousCache.get(key)) !== undefined) {
=======
            if ((value = previousCache[key]) !== undefined) {
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
                update(key, value)
                return value
            }
        },
        set(key, value) {
<<<<<<< HEAD
            if (cache.has(key)) {
                cache.set(key, value)
=======
            if (key in cache) {
                cache[key] = value
>>>>>>> 7e787996e344ec0e38973ffd84b2419f9c179aec
            } else {
                update(key, value)
            }
        },
    }
}
